<!DOCTYPE html>
<html>
<head>
  <title>Time Manager Dashboard</title>
  <link rel="stylesheet" href="shared_styles.css" />
</head>
<body class="dashboard-page">
  <div class="dashboard-header">
    <h2>Task Dashboard</h2>
    <p id="log-display" class="dashboard-status"></p>
  </div>

  <div class="tab-bar">
    <button id="dashboard-tab-button" class="tab-button active" type="button">Dashboard</button>
    <button id="servicenow-tab-button" class="tab-button" type="button">ServiceNow Sync</button>
  </div>

  <div class="dashboard-panel">
    <div id="dashboard-tab-content" class="tab-content active">
    <div class="dashboard-controls">
      <div class="control-group">
        <label for="range-preset">Range:</label>
        <select id="range-preset">
          <option value="today">Today</option>
          <option value="this-week" selected>This Week</option>
          <option value="this-month">This Month</option>
          <option value="all">All Time</option>
          <option value="custom">Custom</option>
        </select>
      </div>
      <div id="custom-range-controls" class="control-group" style="display: none">
        <label for="custom-start-date">From:</label>
        <input type="date" id="custom-start-date" />
        <label for="custom-end-date">To:</label>
        <input type="date" id="custom-end-date" />
        <button id="apply-custom-range-button">Apply</button>
      </div>
      <div class="control-group">
        <label for="period-type">Group By:</label>
        <select id="period-type">
          <option value="day" selected>Day</option>
          <option value="week">Week</option>
        </select>
      </div>
    </div>

    <div class="kpi-grid">
      <div class="kpi-card">
        <p class="kpi-label">Focused Time</p>
        <p id="kpi-total-time" class="kpi-value">0h 0m 0s</p>
      </div>
      <div class="kpi-card">
        <p class="kpi-label">Tasks</p>
        <p id="kpi-task-count" class="kpi-value">0</p>
      </div>
      <div class="kpi-card">
        <p class="kpi-label">Time Blocks</p>
        <p id="kpi-block-count" class="kpi-value">0</p>
      </div>
      <div class="kpi-card">
        <p class="kpi-label">Avg Block</p>
        <p id="kpi-avg-block" class="kpi-value">0h 0m 0s</p>
      </div>
    </div>

    <div class="dashboard-grid">
      <section class="dashboard-section">
        <h3>Task Totals</h3>
        <table id="task-log-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Task Name</th>
              <th>Total Duration</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="button-row" id="task-pagination-controls">
          <button id="task-page-prev">Previous</button>
          <span id="task-page-info">Page 1 of 1</span>
          <button id="task-page-next">Next</button>
        </div>
      </section>

      <section class="dashboard-section">
        <h3>Period Summary</h3>
        <table id="period-summary-table">
          <thead>
            <tr>
              <th>#</th>
              <th id="period-summary-label">Day</th>
              <th>Total Duration</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>
    </div>

    <section class="dashboard-section">
      <button
        id="toggle-blocks-button"
        class="accordion-header"
        type="button"
        aria-expanded="false"
        aria-controls="time-blocks-content"
      >
        <span class="accordion-title">Time Blocks</span>
        <span id="toggle-blocks-hint" class="accordion-hint">Collapsed, click to expand</span>
        <span class="accordion-icon" aria-hidden="true">v</span>
      </button>
      <div id="time-blocks-content" class="collapsible-content" style="display: none">
        <table id="block-log-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Task Name</th>
              <th>Start</th>
              <th>End</th>
              <th>Duration</th>
              <th>Source</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="button-row" id="block-pagination-controls">
          <button id="block-page-prev">Previous</button>
          <span id="block-page-info">Page 1 of 1</span>
          <button id="block-page-next">Next</button>
        </div>
      </div>
    </section>
    <div class="button-row">
      <button id="add-log-button">Add Time Block</button>
    </div>
    </div>

    <div id="servicenow-tab-content" class="tab-content">
      <section class="dashboard-section servicenow-panel">
        <h3>ServiceNow Sync</h3>
        <div class="dashboard-controls">
          <div class="control-group">
            <label for="sn-sync-range-preset">Sync Range:</label>
            <select id="sn-sync-range-preset">
              <option value="today">Today</option>
              <option value="this-week" selected>This Week</option>
              <option value="this-month">This Month</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div id="sn-sync-custom-range-controls" class="control-group" style="display: none">
            <label for="sn-sync-custom-start-date">From:</label>
            <input type="date" id="sn-sync-custom-start-date" />
            <label for="sn-sync-custom-end-date">To:</label>
            <input type="date" id="sn-sync-custom-end-date" />
            <button id="sn-apply-sync-custom-range-button">Apply</button>
          </div>
          <span id="sn-sync-range-preview" class="sync-preview-text"></span>
        </div>
        <div class="servicenow-controls">
          <label class="checkbox-inline" for="sn-enabled">
            <input type="checkbox" id="sn-enabled" />
            Enable ServiceNow integration
          </label>
          <span id="sn-connection-badge" class="sn-connection-badge disconnected">Disconnected</span>
          <label for="sn-instance-url">Instance URL:</label>
          <input type="url" id="sn-instance-url" placeholder="https://your-instance.service-now.com" />
          <button id="sn-save-config-button">Save</button>
          <button id="sn-connect-button">Connect ServiceNow</button>
          <button id="sn-refresh-lookups-button">Refresh ServiceNow Data</button>
          <button id="sn-sync-button">Sync to ServiceNow</button>
        </div>
        <p id="sn-status" class="dashboard-status"></p>
        <p id="sn-sync-report" class="dashboard-status"></p>
      </section>
    </div>
  </div>

  <div id="add-log-modal" class="modal">
    <div class="modal-content">
      <h2 id="add-log-modal-title">Add time block</h2>
      <p id="manual-log-error" class="field-error" role="alert" aria-live="polite"></p>
      <div class="task-log">
        <div class="task-name">
          <label for="task-name">Task / Assigned Task / Category:</label>
          <input
            type="text"
            id="task-name"
            list="sn-assignment-list"
            placeholder="Enter task or search assigned tasks/categories"
          />
          <datalist id="sn-assignment-list"></datalist>
        </div>
        <div class="task-time servicenow-select-wrap" id="sn-code-wrap">
          <label for="sn-code-select">Time Code:</label>
          <select id="sn-code-select"></select>
        </div>
        <div class="task-time servicenow-select-wrap" id="sn-comment-wrap">
          <label for="sn-comment-input">Extra notes:</label>
          <input
            type="text"
            id="sn-comment-input"
            placeholder="Optional for task, required for category"
          />
        </div>
        <div class="task-time">
          <label for="task-start-date">Start Time:</label>
          <div class="inline-date-time">
            <input type="date" id="task-start-date" />
            <input type="time" id="task-start-time" step="60" />
            <button type="button" id="task-start-now-button">Now</button>
          </div>
        </div>
        <div class="task-time">
          <label for="task-duration-time">Duration (HH:MM):</label>
          <input type="time" id="task-duration-time" step="60" value="00:00" />
        </div>
        <div class="task-time">
          <label for="task-end-date">End Time:</label>
          <div class="inline-date-time">
            <input type="date" id="task-end-date" />
            <input type="time" id="task-end-time" step="60" />
            <button type="button" id="task-end-now-button">Now</button>
          </div>
        </div>
      </div>
      <div class="button-row">
        <button id="save-log-button">Save Block</button>
        <button id="cancel-log-button">Cancel</button>
      </div>
    </div>
  </div>
  <script src="time_manager.js"></script>
</body>
</html>

